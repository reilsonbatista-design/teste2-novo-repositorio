name: Node.js CI

on:
  push:
    branches:
      - main  # O workflow será executado em pushes no branch principal
  pull_request:
    branches:
      - main  # Também será executado quando um pull request for feito para o branch principal

jobs:
  build:
    runs-on: ubuntu-latest  # O processo será executado em uma máquina virtual com Ubuntu

    steps:
    - name: Checar o código do repositório
      uses: actions/checkout@v3  # Faz o checkout do código do repositório (atualizado para v3)

    - name: Configurar Node.js
      uses: actions/setup-node@v3 # Atualizado para v3
      with:
        node-version: '20'  # Atualizado para v20, pois o React 19 exige uma versão moderna do Node

    - name: Instalar dependências para o cliente
      # Adicionado --legacy-peer-deps para evitar erros de conflito entre React 19 e bibliotecas de teste
      run: cd client && npm install --legacy-peer-deps

    - name: Rodar os testes no cliente
      # Adicionado CI=true para que o teste não fique travado em modo interativo no GitHub
      run: cd client && CI=true npm test -- --coverage --watchAll=false

    - name: Instalar dependências para o servidor
      run: cd server && npm install  # Instala as dependências na pasta 'server'

    - name: Rodar os testes no servidor
      run: cd server && npm test -- --coverage  # Roda os testes no diretório 'server' e gera um relatório de cobertura (opcional)
